"use strict";function TileShadow(){($(".Tile-Description").parent().mouseenter(function(){$(this).children(".Tile-Description").css("top","115px");$(this).children(".Tile-Description").animate({top:"-=115"},10)}).mouseleave(function(){$(this).children(".Tile-Description").css("top","0");$(this).height()!==300?$(this).children(".Tile-Description").animate({top:"+=115"},10):$(this).children(".Tile-Description").animate({top:"+=275"},10)}),userEditListItemsAllowed!==!1)&&$(function(){$(".column").sortable({connectWith:".column",stop:function(){$(function(){var n=1;$(".tile").each(function(){var t=n+";#"+$(this).parent().attr("id");SP.SOD.executeFunc("sp.js","SP.ClientContext",updateListItem($(this).attr("id"),t));n=n+1;$(this).width()===320&&$(this).parent().width(340);$(this).height()===320?$(this).children().css("top","295px"):$(this).children().css("top","125px")})});SP.SOD.executeFunc("sp.js","SP.ClientContext",function(){SP.UI.Notify.addNotification("The Tiles are updated!",!1)})}})})}function updateListItem(n,t){function f(){}try{if(null===currentUser)return;if(!window.tilesListName)return;var r=clientContext.get_web().get_lists().getByTitle(window.tilesListName),i=r.getItemById(n);i.set_item("TileOrder",t);i.update();clientContext.executeQueryAsync(Function.createDelegate(this,f),Function.createDelegate(this,onQueryFailed))}catch(u){console.log("updateListItem failed. "+u)}}function retrieveListItems(){function t(){for(var v=collListItem.getEnumerator(),d=window.tilesServerRelativeUrl+"Style Library/TilesWp/Images/"+(userEditListItemsAllowed===!0?"EditOption.png":"1pixel.gif"),f=[],p,u,r,c,i,o,s,w,b,k;v.moveNext();){var t=v.get_current(),g=t.get_item("TileOrder"),y=g.split(";#"),nt=parseInt(y[0]),tt=y[1],e=t.get_item("LaunchBehavior"),it=t.get_item("LinkLocation").get_url(),rt=t.get_item("Size"),ut=t.get_id(),ft=t.get_item("Color"),et=t.get_item("BackgroundImageLocation").get_url(),ot=t.get_item("Title"),st=t.get_item("Description1")===null?"":t.get_item("Description1"),n={tilesOrder:nt,columnNo:tt,launchBehavior:e,linkLocation:it,size:rt,itemId:ut,color:ft,backgroundImageLocation:et,title:ot,description:st};f.push(n)}f.sort(function(n,t){return n.tilesOrder-t.tilesOrder});for(p in f){if(n=f[p],u="",r="",n.launchBehavior.indexOf(";")>=0&&n.launchBehavior.indexOf(":")>=0){if(c=n.launchBehavior.split(";"),e=c[0],i=c[1].split(":"),r=" "+i[0]+'="'+i[1]+'" ',o=[],o.push(i[0]+":"+i[1]),i.length>2)for(s=3,w=i.length;s<w;s++)o.push(i(s));try{b=window[i[1]];b.apply(this,o)}catch(ht){console.log("plugIn call failed. "+ht)}}r!==""&&(r+=" onclick='return false;'");e==="Dialog"?(k='ShowDialogTile("'+n.linkLocation+'","'+n.title+'")',u="<a href='#' onclick='"+k+";return false;'"+r+">"):u=e==="New Tab"?"<a href='"+n.linkLocation+"' target='_blank'"+r+">":"<a href='"+n.linkLocation+"'"+r+">";var h=$("#"+n.columnNo),l="",a="";n.size==="LARGE"?(h.css("width","320px"),h.css("height","320px"),l="width:300px;height:300px;",a=" style='width:300px;top:275px;height:300px'"):n.size==="WIDE"&&(h.css("width","320px"),l="width:300px;",a=" style='width:300px;'");h.append("<div id='"+n.itemId+"' class='tile "+n.color+"' style='"+l+"background-image:url("+n.backgroundImageLocation+");'><div class='Tile-Description'"+a+">"+u+"<div style='float:left;width:80%;text-align:left;'>"+n.title+"<\/div><\/a><div style='float:right;width:20%;text-align:right'><a href='#' onclick='ShowDialog("+n.itemId+")' style='text-align:right;z-index:1000'><img src='"+d+"' /><\/a><\/div>"+u+"<div style='height:90%'><p>"+n.description+"<\/p><\/div><\/a><\/div><\/div>")}TileShadow()}var n=new SP.CamlQuery;n.set_viewXml("<View><Query><Where><Eq><FieldRef Name='Hide' /><Value Type='Boolean'>False<\/Value><\/Eq><\/Where><OrderBy><FieldRef Name='TileOrder'  Ascending='FALSE' /><\/OrderBy><\/Query><ViewFields><FieldRef Name='Id' /><FieldRef Name='TileOrder' /><FieldRef Name='Title' /><FieldRef Name='Description1' /><FieldRef Name='BackgroundImageLocation' /><FieldRef Name='LinkLocation' /><FieldRef Name='Color' /><FieldRef Name='LaunchBehavior' /><FieldRef Name='Size' /><\/ViewFields><\/View>");collListItem=oList.getItems(n,"Include(Id,Title,Description1,BackgroundImageLocation,LinkLocation,Color,LaunchBehavior,TileOrder)");clientContext.load(collListItem);clientContext.executeQueryAsync(Function.createDelegate(this,t),Function.createDelegate(this,onQueryFailed))}function getWebPropertiesSucceeded(){var i=3,r,t,n;try{r=webProperties.get_item("vti_TilesColumns");i=r}catch(u){}for(t="",n=0;n<i;n++)t+='<div class="column" id="Col'+n+'"><\/div>';$("#"+tilesTitleId).after(t);getUserAndListItems()}function getUserAndListItems(){function n(){if(null!==currentUser){try{currentUser.retrieve()}catch(n){console.error("getUser failed. "+n);currentUser=null;userEditListItemsAllowed=!1}null!==currentUser&&(oList=clientContext.get_web().get_lists().getByTitle(window.tilesListName),clientContext.load(oList,"EffectiveBasePermissions"),clientContext.executeQueryAsync(function(){oList.get_effectiveBasePermissions().has(SP.PermissionKind.editListItems)&&(userEditListItemsAllowed=!0);retrieveListItems()},Function.createDelegate(this,onQueryFailed)))}}currentUser=clientContext.get_web().get_currentUser();clientContext.load(currentUser);clientContext.executeQueryAsync(Function.createDelegate(this,n),Function.createDelegate(this,onQueryFailed))}function onQueryFailed(n,t){var i="Query failed. Error:"+t.get_message();typeof console!="undefined"&&console.error(i)}function TilesGetColumns(n){tilesTitleId=n;clientContext=SP.ClientContext.get_current();webProperties=clientContext.get_web().get_allProperties();clientContext.load(webProperties);clientContext.executeQueryAsync(Function.createDelegate(this,getWebPropertiesSucceeded),Function.createDelegate(this,onQueryFailed))}function ShowDialog(n){if(null!==currentUser){var t={url:window.tilesServerRelativeUrl+"Lists/Tiles/EditForm.aspx?ID="+n,allowMaximize:!0,title:"Edit Tile",dialogReturnValueCallback:showCallback};SP.SOD.execute("sp.ui.dialog.js","SP.UI.ModalDialog.showModalDialog",t)}return!1}function showCallback(n){n===SP.UI.DialogResult.OK&&SP.UI.ModalDialog.RefreshPage(SP.UI.DialogResult.OK)}function ShowDialogTile(n,t){var i={url:n,allowMaximize:!0,title:t};return SP.SOD.execute("sp.ui.dialog.js","SP.UI.ModalDialog.showModalDialog",i),!1}var clientContext,currentUser,userEditListItemsAllowed=!1,webProperties,collListItem,tilesTitleId,oList;$(document).ready(function(){SP.SOD.executeFunc("sp.js","SP.ClientContext",TilesGetColumns("TitleSettings"))});
//# sourceMappingURL=App.min.js.map
